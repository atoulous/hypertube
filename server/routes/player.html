<!--

	Just a temporary testing "script". Will be deleted.

-->

<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

<video id="video" width="400" height="400" controls></video>
<div class="loading">
	<h1>Your video is loading. Please wait, this may take up to 30s...</h1>
</div>

<div class='mList'></div>

<script>
let video = null
	let vid = null
	let hls = null

	$.get('http://127.0.0.1:5000/media', (res) => {
		res.forEach((el) => {
			$('.mList').html('<a href="#" class="startMedia" data-vid="' + el._id + '">' + el._id + ' ' + el.displayName + '</a><br />' + $('.mList').html())
		})
	})

	$('video').hide()
	$('.loading').hide()
	$(document).on('click', '.startMedia', (event) => {
		vid = $(event.target).data('vid')
		$('video').hide()
		$('.loading').show()

		console.log('Sending request...')
		$.get('http://127.0.0.1:5000/startmedia/' + vid, () => {
			console.log('Request is back, media is ready, starting playback')


			video = document.getElementById('video');
			if(Hls.isSupported()) {
				hls = new Hls({startPosition : 0});
				hls.loadSource('http://127.0.0.1:5000/' + vid + '/master.m3u8');
				hls.attachMedia(video);
				hls.on(Hls.Events.MANIFEST_PARSED,function() {
					if (hls.subtitleTracks.length !== 0) {
						hls.subtitleDisplay = true
					}
					$('video').show()
					$('.loading').hide()
				})
			}

		})
	})
</script>
